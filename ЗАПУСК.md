# Инструкция по запуску NotifySys

## Требования
- .NET SDK 8.0 или выше
- Node.js 16+ и npm
- PostgreSQL (или Docker для запуска БД)
- Telegram Bot Token

## 1. Запуск Backend (API)

### Вариант 1: Через Docker (рекомендуется)
```bash
cd API
docker-compose up -d
```

### Вариант 2: Локально
```bash
cd API

# Настройте .env файл с параметрами БД и Telegram Bot
# Пример:
# ConnectionStrings__DefaultConnection=Host=localhost;Database=notifysys;Username=postgres;Password=yourpassword
# Jwt__Key=your-secret-key-min-32-characters
# TelegramBot__Token=your-telegram-bot-token

# Запуск API
dotnet run
```

API будет доступен на: **http://localhost:8080**

Swagger UI: **http://localhost:8080/swagger**

## 2. Запуск Frontend

```bash
cd FRONT

# Установка зависимостей (первый раз)
npm install

# Запуск dev сервера
npm start
```

Frontend будет доступен на: **http://localhost:3000**

## 3. Проверка работы

### Swagger
Откройте http://localhost:8080/swagger и проверьте доступные endpoints:
- GET /api/users - список пользователей
- GET /api/regions/statistics - статистика по городам
- POST /api/notifications/user - отправка сообщения пользователю
- POST /api/notifications/city - отправка сообщения в город

### Frontend
Откройте http://localhost:3000 и проверьте:
1. Главное меню
2. Регионы - статистика по городам
3. Пользователи - список всех пользователей
4. Отправка предупреждений

## Структура проекта

```
NotifySys/
├── API/                          # Backend
│   ├── Controllers/              # HTTP endpoints (try/catch, Ok/BadRequest)
│   ├── Handlers/                 # Бизнес-логика из Menu
│   ├── Services/                 # JwtService, NotificationService
│   ├── SearchingInBD/            # BD.SearchByCity, BD.SearchUser
│   ├── MailManager/              # NotificationService для Telegram
│   ├── Models/                   # User, BaseContext
│   └── Program.cs                # Настройка приложения
│
└── FRONT/                        # Frontend
    └── src/
        ├── handlers/
        │   └── api.js            # HTTP запросы к API
        ├── components/           # React компоненты
        │   ├── MainMenu.js
        │   ├── RegionsMenu.js
        │   ├── UsersMenu.js
        │   └── SendWarningMenu.js
        └── App.js                # Главный компонент
```

## Архитектура запросов

```
Frontend (handlers/api.js)
    ↓ HTTP Request
Backend (Controllers)
    ↓ try/catch
Backend (Handlers)
    ↓ вызов методов
Services / BD / MailManager
```

## Troubleshooting

### API не запускается
- Проверьте, что PostgreSQL запущен
- Проверьте настройки в `.env` файле
- Проверьте, что порт 8080 свободен

### Frontend не подключается к API
- Убедитесь, что API запущен на http://localhost:8080
- Проверьте CORS настройки в Program.cs
- Откройте консоль браузера для просмотра ошибок

### Ошибки БД
- Проверьте строку подключения в `.env`
- Миграции применяются автоматически при запуске API
- Проверьте логи в папке `API/logs/`

## Полезные команды

### Backend
```bash
# Сборка проекта
dotnet build

# Запуск тестов (если есть)
dotnet test

# Создание новой миграции
dotnet ef migrations add MigrationName

# Применение миграций
dotnet ef database update
```

### Frontend
```bash
# Установка зависимостей
npm install

# Запуск dev сервера
npm start

# Сборка для production
npm run build

# Проверка кода
npm run lint
```

## Переменные окружения

### API/.env
```env
# База данных
ConnectionStrings__DefaultConnection=Host=localhost;Database=notifysys;Username=postgres;Password=yourpassword

# JWT
Jwt__Key=your-secret-key-minimum-32-characters-long
Jwt__Issuer=NotifySysAPI
Jwt__Audience=NotifySysAPI

# Telegram Bot
TelegramBot__Token=your-telegram-bot-token-from-botfather
```

### FRONT/src/handlers/api.js
```javascript
const API_URL = 'http://localhost:8080'; // Измените для production
```
